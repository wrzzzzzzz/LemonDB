# LemonDB - Multithreaded Database System

## Introduction

LemonDB is a robust database system developed by Lemonion Inc., designed to handle important customer information efficiently. Originally developed as a single-threaded application, LemonDB faced a critical crash, leading to the loss of some source codes and malfunctioning of the database. In response, our team at Lemonion Inc. has restored and enhanced LemonDB, transforming it into a multithreaded database system for improved performance and design.

### Components

- **Source Code**: Located in `./src`, containing the original LemonDB source code, recovered from a crash site. Uses CMake for building.
- **Binary**: The latest executable is in `./bin`.
- **Database Files**: Sample databases are stored in `./db`.
- **Samples**: Sample inputs and outputs are available in `./sample`.

## Developer Quick Start

### Building from Source

Refer to `INSTALL.md` for detailed instructions on how to build from source. We employ `ClangFormat` and `EditorConfig` for code formatting. Use the following command for `ClangFormat`:

```
luaCopy code
find . -name "*.cpp" -o -name "*.h" | sed 's| |\\ |g' | xargs clang-format -i
```

Ensure your code editor supports `EditorConfig`.

### Compiling the Program

To compile LemonDB:

```
bashCopy codecd src/build # Navigate to the build directory
cmake -DCMAKE_C_COMPILER=/usr/bin/clang -DCMAKE_CXX_COMPILER=/usr/bin/clang++-16 .. # Create a configuration file for compilation
cmake --build . -- -j8 # Compile
mkdir bin # Create a directory for the executable
cp ./lemondb bin
cd bin # Move to the bin directory
```

## Usage

### Running the Program

To run LemonDB:

```
bashCopy code
./lemondb --listen $ some query file $  > test.out
```

Output can be found in `test.out`.

### Database Conventions

- **Table Format**: Follows SQL conventions, with integer values.
- **Data Retrieval**: Custom `.query` files using standard SQL patterns. Supports operations like `ADD`, `COUNT`, `DELETE`, `INSERT`, `MAX`, `MIN`, `SELECT`, `SUBTRACT`, `SUM`, `SWAP`, `UPDATE`, `COPYTABLE`, `DUMP`, `DROP`, and `TRUNCATE`.

## Design and Enhancements

### Threadpool and Multithreading

LemonDB now employs a threadpool to handle queries in parallel, significantly enhancing processing speed. The database operations are divided into two categories based on their suitability for multithreading, ensuring optimal performance.

### Validation and Testing

The correctness of our program can be readily available from the report sent by drone, which was generated by our `run.sh` testing file.
As for the speed of the program, it can be validated by running the following commands sequentially and comparing the real time elapse.

```bash
time ./lemondb --listen $ some query file $ # our program
time lemondb --listen $ some query file $ # baseline
```

By running the time test several times and comparing with the baseline performance, we can safely draw the conclusion that we significantly improved the speed of the database system and increased on efficiency.

## Acknowledgements

Our heartfelt thanks to the dedicated team members at Lemonion Inc., whose relentless efforts made this project successful. We also appreciate the support and guidance from the teaching team, making this journey rewarding and educational.

## Copyright

Lemonion Inc. 2018